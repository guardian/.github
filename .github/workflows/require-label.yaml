name: Require PR Label

on:
  workflow_call:

permissions: 
  contents: read
  
jobs:
  require-label:
    runs-on: ubuntu-latest
    steps:
      - name: Check for required label
        uses: actions/github-script@ed597411d8f924073f98dfc5c65a23a2325f34cd # v8.0.0
        with:
          script: |
            const {data: issue} = await github.rest.issues.get({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
            });
            const requiredLabels = ['fix', 'feature', 'maintenance', 'not sure', 'dependencies'];
            const labelNames = issue.labels.map(label => label.name.toLowerCase());
            const hasRequired = labelNames.some(label => requiredLabels.includes(label));
            if (!hasRequired) {
              core.setFailed(`Pull requests must include a Core4 label: ${requiredLabels.join(', ')}.`);
            }