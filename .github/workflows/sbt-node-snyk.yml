name: SBT Node Snyk

on:
  workflow_call:
    inputs:
      DEBUG:
        type: string
        required: false
    secrets:
      SNYK_TOKEN:
        required: true

jobs:
    security:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout branch
              uses: actions/checkout@v2

            - name: Setup debug var
              run: echo INPUT_DEBUG=${{ inputs.DEBUG }} >> $GITHUB_ENV
              shell: bash

            - name: Get node version
              run: echo NODE_VERSION=$(cat .nvmrc) >> $GITHUB_ENV

            - uses: snyk/actions/setup@0.3.0
            - uses: actions/setup-node@v2
              with:
                  node-version: ${{ env.NODE_VERSION }}

            - uses: actions/setup-java@v2
              with:
                  java-version: "8"
                  distribution: "adopt"

            - name: Snyk monitor
              run: snyk monitor --all-projects ${INPUT_DEBUG:+ -d}
              env:
                  SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}