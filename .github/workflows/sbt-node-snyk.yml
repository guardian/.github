name: Simple Snyk monitor for SBT + Node

on:
  workflow_call:
    inputs:
      SKIP_NODE:
        type: boolean
        required: false
        default: false
      SKIP_SBT:
        type:boolean
        required: false
        default: false
      DEBUG:
        type: string
        required: false
      ORG:
        type: string
        required: true
      JAVA_VERSION:
        type: string
        required: false
        default: "11"
      NODE_VERSION_FILE:
        type: string
        required: false
        default: ".nvmrc"
    secrets:
      SNYK_TOKEN:
        required: true

jobs:
    security:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout branch
              uses: actions/checkout@v2

            - uses: snyk/actions/setup@0.3.0

            - uses: actions/setup-node@v2
              if: !inputs.SKIP_NODE
              with:
                  node-version-file: ${{ inputs.NODE_VERSION_FILE }}

            - uses: actions/setup-java@v2
              if: !inputs.SKIP_SBT
              with:
                  java-version: ${{ inputs.JAVA_VERSION }}
                  distribution: "adopt"

            - name: Snyk monitor
              run: snyk monitor ${INPUT_DEBUG:+ -d} --all-projects --org="${{ inputs.ORG }}"
              env:
                  SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
                  INPUT_DEBUG: ${{ inputs.DEBUG }}
